#+TITLE: How to install mercurial.
#+AUTHOR: Takumi IINO (troter)
#+EMAIL: takumi@timedia.co.jp, trot.thunder@gmail.com
#+LANGUAGE: ja

#+OPTIONS: ^:nil toc:3
#+STYLE: <link rel="stylesheet" type="text/css" href="org-mode-document.css" />

* はじめに

  - このドキュメントは[[http://kokucheese.com/event/index/13468/][SCM Boot Camp in Tokyo(2011-07-30)]]配布資料の原稿です。
  - mercurialのインストールドキュメントが[[https://github.com/troter/troter.github.com/tree/master/how-to-install-mercurial][github]]に上がっていることに疑問を覚えないこと。

* Mercurialの入手方法
  次のURLから取得できます。

  [[http://mercurial.selenic.com/downloads/]]

* Windowsの場合

  Windowsの場合、次の選択肢からMercurialをインストールする方法を選ぶことが出来ます。

  | 要求                                   | インストール方法                                                |
  |----------------------------------------+-----------------------------------------------------------------|
  | GUI を利用したい場合                   | TortoiseHgをインストール                                        |
  | CUI Windows版バイナリ を利用したい場合 | MSI installer もしくはInno Setup installer を使ってインストール |
  | CUI Cygwinから利用したい場合           | Linux/Cygwinの場合を参照                                        |

** TortoiseHgをインストール

  MercurialをGUIで利用したい場合はTortoiseHgをインストールしてください。TortoiseHgインストール後、OSの再起動は必要ありません。

*** インストール

  1.まず http://mercurial.selenic.com/downloads/ からTortoiseHgのインストーラをダウンロードします。

    #+ATTR_HTML: alt="TortoiseHGのダウンロード"
    [[file:tortoisehg-download.png]]

  2.ダウンロードしたTortoiseHgインストーラを実行します。

    #+ATTR_HTML: alt="TortoiseHGインストーラの実行"
    [[file:tortoisehg-installer-start.png]]

  3.ライセンスに同意します。問題無ければ「Next」をクリックします。

    #+ATTR_HTML: alt="TortoiseHGインストーラ、ライセンスに同意"
    [[file:tortoisehg-installer-license-agreement.png]]

  4.インストール内容の確認を行います。インストール先を変更する場合は「Browse」を。問題無ければ「Next」をクリックします。

    #+ATTR_HTML: alt="TortoiseHGインストーラ、インストール内容の確認"
    [[file:tortoisehg-installer-custom-setup.png]]

  5.インストール前の確認です。問題無ければ「Install」をクリックします。

    #+ATTR_HTML: alt="TortoiseHGインストーラ、インストール前の確認"
    [[file:tortoisehg-installer-ready-to-install.png]]

  6.インストールが開始されます。

    #+ATTR_HTML: alt="TortoiseHGインストーラ、インストール"
    [[file:tortoisehg-installer-installing.png]]

  7.インストール時にエクスプローラの再起動を要求されます。問題無ければ「OK」をクリックします。

    #+ATTR_HTML: alt="TortoiseHGインストーラ、エクスプローラの再起動"
    [[file:tortoisehg-installer-explorer-restart-request.png]]

  8.問題が無ければインストール完了です。

    #+ATTR_HTML: alt="TortoiseHGインストーラ、インストール完了"
    [[file:tortoisehg-installer-finish.png]]

*** インストール後の確認

  エクスプローラの右クリックメニューを確認してみましょう。

    #+ATTR_HTML: alt="TortoiseHG 右クリックメニュー"
    [[file:tortoisehg-explorer-menu.png]]

  「About TortoiseHg」をクリックして見ましょう。

    #+ATTR_HTML: alt="TortoiseHG 情報"
    [[file:tortoisehg-about.png]]

*** KDiff3の代わりにWinMergeを利用する

  TortoiseHgにはKDiff3がバンドルされていますが、いまいち使いにくいのでWinMergeを利用するように変更します。

  右クリックメニューから「Global Settings」を選択します。
  
    #+ATTR_HTML: alt="TortoiseHG Global Settings"
    [[file:tortoisehg-explorer-menu-global-settings.png]]

  「TortoiseHg」の「3-wayマージツール」、「GUI差分表示ツール」のプルダウンから「winmergeu」を選択します。

    #+ATTR_HTML: alt="TortoiseHG Global Settings"
    [[file:tortoisehg-global-settings-tortoisehg.png]]

** MSI installerを使って

  GUIシェル拡張は不要でhgコマンドのみインストールしたい場合は MSI installer を利用してインストールします。

*** インストール

  1.まず http://mercurial.selenic.com/downloads/ からMSI installerダウンロードします。

    #+ATTR_HTML: alt="TortoiseHGのダウンロード"
    [[file:msi-installer-download.png]]

  2.ダウンロードしたTortoiseHgインストーラを実行します。

    #+ATTR_HTML: alt="TortoiseHGインストーラの実行"
    [[file:msi-installer-start.png]]

  3.ライセンスに同意します。問題無ければ「Next」をクリックします。

    #+ATTR_HTML: alt="TortoiseHGインストーラ、ライセンスに同意"
    [[file:msi-installer-license-agreement.png]]

  4.インストール内容の確認を行います。インストール先を変更する場合は「Browse」を。問題無ければ「Next」をクリックします。

    #+ATTR_HTML: alt="TortoiseHGインストーラ、インストール内容の確認"
    [[file:msi-installer-custom-setup.png]]

  5.インストール前の確認です。問題無ければ「Install」をクリックします。

    #+ATTR_HTML: alt="TortoiseHGインストーラ、インストール前の確認"
    [[file:msi-installer-ready-to-install.png]]

  6.インストールが開始されます。

    #+ATTR_HTML: alt="TortoiseHGインストーラ、インストール"
    [[file:msi-installer-installing.png]]

  7.問題が無ければインストール完了です。

    #+ATTR_HTML: alt="TortoiseHGインストーラ、インストール完了"
    [[file:msi-installer-finish.png]]


** Inno Setup installerを使って

  MSI Installerは管理者権限が必要でしたが、Inno Setup installerを利用すると一般ユーザでもインストールが行えます。

  インストール方法はMSI Installerと同じですので、ここでは説明を割愛します。

* MacOSXの場合

** MacHgのインストール

  TODO

** 公式バイナリから

  TODO

** macportsを使って

  TODO

** homebrewを使って

  TODO

** pkgsrcを使って

  TODO

* Linux/Cygwinの場合

** 各ディストリビュージョンのパッケージから

  TODO  

** easy_installを使って

  easy_install(setuptools)をつかってPyPIからMercurial [fn:pypi-mercurial] をインストールする事も出来ます。

  システムのpythonを利用した場合、/usr/binにインストールするので気をつけてください。
[fn:pypi-mercurial] http://pypi.python.org/pypi/Mercurial/1.9  

*** easy_installのインストール

  まずeasy_installをインストールしましょう。
  easy_installはez_setup.pyというブートストラップモジュールを使ってインストールすると簡単です。

  #+BEGIN_SRC shell
  % curl -O http://peak.telecommunity.com/dist/ez_setup.py
  % python ez_setup.py
  #+END_SRC

  ez_setup.pyを利用しない場合は[[http://pypi.python.org/pypi/setuptools][pypiのsetuptoolsページ]]から適切なeggをダウンロードし、シェルスクリプトとして実行します。

  #+BEGIN_SRC shell
  % curl -O http://pypi.python.org/packages/2.6/s/setuptools/setuptools-0.6c11-py2.6.egg
  % sh setuptools-0.6c11-py2.6.egg
  #+END_SRC

*** easy_intallでmercurialをインストール

  easy_installを使ってmercurialをインストールします。

  #+BEGIN_SRC shell
  % easy_install -U mercurial
  #+END_SRC

** ソースから

  mercurial 1.4以降はdocutilsというパッケージに依存しています。easy_installを利用する場合は依存関係解決の中で自動的にインストールされますが、
  ソースからインストールする場合は自前でインストールする必要があります。

*** docutilsのインストール

  easy_installを利用する事も出来ます。

  #+BEGIN_SRC shell
  % easy_install -U docutils
  #+END_SRC

  ソースコードからインストールする場合は、[[http://docutils.sourceforge.net/][docutilsのサイト]]からアーカイブを取得します。

  #+BEGIN_SRC shell
  % tar zxvf docutils-0.8.tar.gz
  % cd docutils-0.8
  % ./setup.py install
  #+END_SRC

*** mercurialのソースコードアーカイブの取得

  ソースコードアーカイブを取得、展開します。

  #+BEGIN_SRC shell
  % curl -O http://mercurial.selenic.com/release/mercurial-1.9.tar.gz
  % tar zxvf mercurial-1.9.tar.gz
  % cd mercurial-1.9
  #+END_SRC

  mercurialにはconfigureスクリプトは同梱されていないので、適切にmakeコマンドに引数を与えてインストールします

*** ユーザ毎にインストール

   ~/bin、~/lib以下にインストールする場合です。

  #+BEGIN_SRC shell
  % make install-home
  #+END_SRC

*** システムワイドにインストール

   /usr/local以下にインストールする場合です。

  #+BEGIN_SRC shell
  % make install
  #+END_SRC

  プレフィックスを変更する場合はPREFIXを指定します。

  #+BEGIN_SRC shell
  % make install PREFIX=/path/to/mercurial
  #+END_SRC

* 参考文献

  - [[http://mercurial.selenic.com/wiki/Download][Download]]
  - [[http://mercurial.selenic.com/wiki/WindowsInstall][WindowsInstall]]
  - [[http://mercurial.selenic.com/wiki/UnixInstall][UnixInstall]]
